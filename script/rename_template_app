#!/usr/bin/env bash

# Exit if any subcommand fails
set -e
set -o pipefail

source script/helpers/text_helpers
source script/helpers/function_helpers

NEW_APP_NAME=$1

replace_text() {
  OUTGOING=$1
  INCOMING=$2

  notice "Replacing '$1' with '$2'"

  GREP_OPTIONS=( --exclude-dir={script,lib,tmp} --exclude=README.md -r -l )

  if is_mac; then
    grep ${GREP_OPTIONS[@]} "$OUTGOING" * | xargs sed -i "" "s/$OUTGOING/$INCOMING/g"
  else
    grep ${GREP_OPTIONS[@]} "$OUTGOING" * | xargs sed -i "s/$OUTGOING/$INCOMING/g"
  fi
}

rename_file() {
  OUTGOING=$1
  INCOMING=$2

  notice "Renaming '$1' to '$2'"

  mv $1 $2
}

replace_text "lucky_jumpstart" $NEW_APP_NAME
print_done

replace_text "Lucky Jumpstart" $NEW_APP_NAME
print_done

rename_file src/lucky_jumpstart.cr src/$NEW_APP_NAME.cr
print_done
